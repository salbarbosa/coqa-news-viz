---------------------------- Application Description ---------------------------
CoQA News Viz
This application was built to provide visualization in support of research into conversational question answering using the CoQA dataset.  It is inextricably linked to the format of two input files:

1) A json file named coqa-news-preprocessed-final.json, containing information pre-processed (for part-of-speech, named entities, dependencies, coreferences, ...) with the Stanford CoreNLP system.  

2) A text file named sentence-scores.txt (a sample is provided) which is generated by an external NLP method, and holds a score for each sentence of the passage, as it relates to its ranking for containing the answer to each question for that passage.  The application must provide a score for each of the 326,642 passage, question, and sentence in passage mappings. The first column contains passage#.question#.sentence# (each index is separated by a period) and column 2 is the score for that combination.  All indices in the file are zero-based (and are translated by the application and displayed as one-based values).

It also requires 4 png files (arrows used for widgets).  There's probably a way to not require these explicitly, but I'm not sure what that is.

---------------------------- Preprocessed File Format ---------------------------

The format of the data is briefly highlighted here.  Details are available in the code:

The json file is a dictionary containing 2 keys: version (the version of the CoQA dataset) and data (the preprocessed data).
	The value of "data" is a list of 1701 elements, each of which is a (preprocessed) CNN news story from the CoQA set.
	Each story is a dictionary with the following keys:
		story_num: A one-based story number (1..1701)
		id: the story's identifier in the original CoQA
		story: A text string containing the entire news story
		seg_text: A list of strings, one per sentence in the story/passage.
		seg_tagged: A list of lists (one list per sentence). Each sentence list is itself a list of lists (one list per token in the sentence).  Each token list has 6 elements:
			Index 0: The token itself
			Index 1: The token's POS tag
			Index 2: The token's lemmatized form, if it differs from the token, or a tilde(~) if lemma = token.
			Index 3: The token's named entity type, in one of the following forms:
				a.  The named entity type and its compound form (connected with underscores) - Stored only in the first token in a compound named entity. Example: STATE_OR_PROVINCE New_York (the state) is stored in token "New".  Tokens New and York were combined into New_York (STATE_OR_PROVINCE is a named entity type in Stanford CoreNLP).
				b.  The < symbol (indicating that tokens to the left of this one contain the named entity information) - Stored in all but the first token in a compound named entity. Example: < is stored with the "York" token in the above example for New York.
				c.  The named entity type for a single-token named entity.  Example: The named entity type PERSON would be found in the list for token "Smith" when that that token is used in non-compound form. 
		seg_dep: The dependency parse type and the token index of the dependency relation.
		q_text: A list of strings, one per sentence in each question.
		q_tagged: As described in seg_tagged above, but for the question.  Note that interrogatory words of interest were give an special POS tag: The word where gets POS tag WHERE (rather than WRB from the Penn Treebank tag set).  These could easily be reset to Penn Treebank.
		quoted: Not used by this application.
		q_dep: The dependency parse for the question
		a_text: A list of strings, one per sentence in the answer.
		a_tagged: As described in seg_tagged above, but for the answer.  
		rationale: A mapping of the string-based answer rationale in the CoQA dataset, to the token-based rationale required for this application. 
		corefs: A mapping of coreferences directly extracted from Stanford CoreNLP.

---------------------------- Running the Application ---------------------------

To run CoQA News Viz:
Place the Python script, preprocessed json file, and sentence scores text file (generated by your application) in the same directory/folder. Run it as you would any Python script on your system.

---------------------------- User Interface Description ---------------------------

Passage Panel
The passage panel is where the news story of interest is displayed.  Each token in the passage is displayed as its own entity.  Values above the first token in each sentence show the ranking (from 1 to the number of sentences in the story) and score given to that sentence.  The ranking is externally generated by machine learning and other techniques and is supplied to CoQA News Viz in the file sentence-scores.txt (see code comments).  It indicates the likelihood that the sentence contains the answer to the question shown in the QA panel.

The seemingly redundant Passage number and News Story # was previously used to display topic-related news stories (for example only news stories about crimes).  In this case the passage number was sequential (1 to n) but the News Story # referred to the story's order in the full preprocessed dataset.

The Find box (also activated by Ctrl-F) allows for case-insensitive searching at the token level (patterns spanning multiple tokens are not found).  Once a pattern is found it is highlighted by a blue box, the F3 key can then be used to move to its next occurrence, and Shift-F3 moves to the previous occurrence.  Search transits across both the Passage and QA Panels.

The black box around a token in each sentence indicates that sentence's dependency parse root (as identified by Stanford CoreNLP).

Hovering the mouse over the upper left of each token (including those in the QA Panel) results in an information box being displayed.  The lines of information are:
POS: Part-of-speech tag.
NE: Named-entity type, possibly followed by a compound named entity, connected with underscore (Michael_Jackson).
lemma: the token's lemma form (only if it differs from the token itself).
DEP: the dependency parse type and the token to which it relates.  Only select dependencies are shown (see the code).
Position information (separated by slashes): S = sentence number; W = word order (within the sentence); X is x coordinate; Y is y coordinate, L is line number. The sentence and word indices are one-based.


Question Answer (QA) Panel
Displays the question number, and the individual tokens in the question and its answer in the CoQA dataset.

Grammar and Control Panel
The "Go To Passage #" box allows direct access to a passage (one-based).

The left and right arrow widgets (and left and right arrow keys on the keyboard) allow scrolling through passages.  These "wrap-around" if at the first or last passage.

The up and down arrow widgets (and up and down arrow keys on the keyboard) allow scrolling through the question/answer pairs of the displayed passage.  These "wrap-around" if at the first or last question/answer.

Part-of-Speech Tags Checkboxes: Selecting the checkboxes allows colorizing of tokens, in the passage and QA panels, by a subset of POS tags.  POS tags cannot be displayed at the same time as named entity types (they're mutually exclusive for display).

Named Entity Types Checkboxes:  Selecting the checkboxes allows colorizing of tokens, in the passage and QA panels, by (groupings of) named entity types. Groupings are self-explanatory in the code.  Examples include placing CITY, COUNTRY, STATE_OR_PROVINCE, and LOCATION under the LOC checkbox, and combining DATE, DURATION, and TIME under the TME checkbox. The QTY (quantity) and ATR (attributes) are also groups.  Named entity types cannot be displayed at the same time as POS tags (they're mutually exclusive for display).

Dependency Parse Checkboxes: Selecting the checkboxes colorizes tokens by (groupings of) dependency types, and allows display of the linked relationships (if the Deps checkbox is selected - see below). Each group's composition is readily seen in the code.  The unlabeled checkbox is a catch-all that is used with various different constituents, as required by the application.

Rationale Checkbox: Selecting this checkbox places a transparent highlight box over the span of text identified in the CoQA dataset as the rationale for the answer given.

Corefs Checkbox: Selecting this checkbox displays linked coreferences in the passage panel, as identified by Stanford CoreNLP. The links are displayed in randomized different colors (to allow for better trace following), and take on a curved path to declutter the area around tokens which are linked to by a lot of other tokens.

Deps Checkbox: Selecting this checkbox displays the token relationships of the selected dependency types.

My Unfinished To-Do List (and how you can improve this)
Passage and QA Panels
-Make the panels a scrollable text box so that passages of any length may be viewed (but do so while preserving the visualization of annotations).  The passage panel (and size of the token font) was designed to accommodate the longest news story, and passages much longer than that will not fit.
-Grammar and Control Panel
--Add more parts of speech.
--Subdivide named entity groups into individual types
--Add unsupported named entity types
--Add more dependency parse types and relations
--Add additionally application specific information 
